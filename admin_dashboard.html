<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .header { 
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%); 
            color: #fff; 
            padding: 12px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }
        .header h1 { font-size: 1.4rem; font-weight: 700; }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .btn { 
            padding: 6px 12px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .btn-info { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; }
        .btn-sm { padding: 4px 8px; font-size: 0.75rem; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        .stat-card { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); 
            text-align: center; 
            transition: transform 0.2s ease;
        }
        .stat-card:hover { transform: translateY(-2px); }
        .stat-number { 
            font-size: 2rem; 
            font-weight: 700; 
            color: #667eea;
            margin-bottom: 5px;
        }
        .stat-label { color: #6b7280; font-weight: 500; font-size: 0.9rem; }
        .stat-icon { font-size: 1.5rem; margin-bottom: 8px; }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }
        .action-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.2s ease;
        }
        .action-card:hover { transform: translateY(-2px); }
        .action-card h4 { font-size: 0.9rem; margin-bottom: 5px; }
        .action-card p { font-size: 0.75rem; margin-bottom: 10px; color: #6b7280; }
        
        .card { 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 12px; 
            padding: 20px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); 
            margin-bottom: 20px;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .table-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }
        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .table { 
            width: 100%; 
            border-collapse: collapse; 
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .table th { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 10px; 
            font-weight: 600;
            font-size: 0.875rem;
            text-align: left;
        }
        .table td { 
            padding: 10px; 
            border-bottom: 1px solid #f1f5f9; 
            background: white;
            font-size: 0.875rem;
        }
        .table tr:hover td { background: #f8fafc; }
        
        .badge { 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 0.75rem; 
            font-weight: 500;
            text-transform: capitalize;
        }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-resolved { background: #d1fae5; color: #065f46; }
        .badge-in-progress { background: #dbeafe; color: #1e40af; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }
        .modal-close {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .feedback-info {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .chart-container {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .chart-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #374151;
        }
        
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .stats-grid { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
            .table-header { flex-direction: column; align-items: stretch; }
            .modal-content { width: 95%; padding: 25px; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #10b981;
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .notification.show { transform: translateX(0); }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Admin Control Center</h1>
        <div class="header-actions">
            <button onclick="showStatisticalView()" class="btn btn-info">üìä Analytics</button>
            <button onclick="exportData()" class="btn btn-warning">üì• Export</button>
            <button onclick="refreshData()" class="btn btn-success">üîÑ Refresh</button>
            <span style="margin: 0 15px; font-weight: 500;">Welcome, Admin</span>
            <a href="index.html" class="btn btn-danger">üö™ Logout</a>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-number" id="totalFeedback">0</div>
                <div class="stat-label">Total Feedback</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-number" id="resolvedFeedback">0</div>
                <div class="stat-label">Resolved</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-number" id="pendingFeedback">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-number" id="avgRating">0</div>
                <div class="stat-label">Avg Rating</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-number" id="responseRate">0%</div>
                <div class="stat-label">Response Rate</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="action-card">
                <h4>üéØ Quick Respond</h4>
                <p>Respond to pending feedback</p>
                <button onclick="showPendingOnly()" class="btn btn-primary btn-sm">View Pending</button>
            </div>
            <div class="action-card">
                <h4>üìä Analytics</h4>
                <p>View detailed statistics</p>
                <button onclick="showStatisticalView()" class="btn btn-info btn-sm">Open Analytics</button>
            </div>
            <div class="action-card">
                <h4>üì• Export Data</h4>
                <p>Download feedback data</p>
                <button onclick="exportData()" class="btn btn-warning btn-sm">Export CSV</button>
            </div>
            <div class="action-card">
                <h4>üîç Search</h4>
                <p>Find specific feedback</p>
                <button onclick="showSearchModal()" class="btn btn-success btn-sm">Advanced Search</button>
            </div>
        </div>

        <!-- Feedback Table -->
        <div class="card">
            <div class="table-header">
                <h3>üìã Feedback Management</h3>
                <div class="table-filters">
                    <select id="statusFilter" onchange="filterFeedback()" class="filter-select">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="in_progress">In Progress</option>
                        <option value="resolved">Resolved</option>
                    </select>
                    <select id="categoryFilter" onchange="filterFeedback()" class="filter-select">
                        <option value="all">All Categories</option>
                        <option value="Product">Product</option>
                        <option value="Service">Service</option>
                        <option value="Website">Website</option>
                        <option value="Support">Support</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="ratingFilter" onchange="filterFeedback()" class="filter-select">
                        <option value="all">All Ratings</option>
                        <option value="5">5 Stars</option>
                        <option value="4">4 Stars</option>
                        <option value="3">3 Stars</option>
                        <option value="2">2 Stars</option>
                        <option value="1">1 Star</option>
                    </select>
                </div>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>üë§ User</th>
                        <th>üìù Title</th>
                        <th>üìÇ Category</th>
                        <th>‚≠ê Rating</th>
                        <th>üìä Status</th>
                        <th>üìÖ Date</th>
                        <th>‚ö° Actions</th>
                    </tr>
                </thead>
                <tbody id="feedbackTableBody">
                    <tr><td colspan="7" style="text-align: center; padding: 40px; color: #6b7280;"><div class="loading"></div> Loading feedback...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Response Modal -->
    <div id="responseModal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <h3>üí¨ Respond to Feedback</h3>
                <button onclick="closeResponseModal()" class="modal-close">‚úï Close</button>
            </div>
            <div id="feedbackInfo" class="feedback-info"></div>
            <div class="form-group">
                <label class="form-label">Your Response</label>
                <textarea id="responseText" class="form-control" rows="4" placeholder="Enter your detailed response..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Update Status</label>
                <select id="statusSelect" class="form-control">
                    <option value="pending">‚è≥ Pending</option>
                    <option value="in_progress">üîÑ In Progress</option>
                    <option value="resolved">‚úÖ Resolved</option>
                </select>
            </div>
            <div style="text-align: right; gap: 15px; display: flex; justify-content: flex-end;">
                <button onclick="closeResponseModal()" class="btn" style="background: #6b7280; color: white;">Cancel</button>
                <button onclick="submitResponse()" class="btn btn-primary">Send Response</button>
            </div>
        </div>
    </div>

    <!-- Statistical View Modal -->
    <div id="statisticalModal" class="modal">
        <div class="modal-content" style="width: 1200px;">
            <div class="modal-header">
                <h3>üìä Statistical Analysis Dashboard</h3>
                <button onclick="closeStatisticalModal()" class="modal-close">‚úï Close</button>
            </div>
            <div class="charts-grid">
                <div class="chart-container">
                    <h4 class="chart-title">üìä Status Distribution</h4>
                    <canvas id="statusChart" width="300" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h4 class="chart-title">üìã Category Distribution</h4>
                    <canvas id="categoryChart" width="300" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h4 class="chart-title">‚≠ê Rating Distribution</h4>
                    <canvas id="ratingChart" width="300" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h4 class="chart-title">üìà Key Metrics</h4>
                    <canvas id="metricsChart" width="300" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="modal">
        <div class="modal-content" style="width: 500px;">
            <div class="modal-header">
                <h3>üîç Advanced Search</h3>
                <button onclick="closeSearchModal()" class="modal-close">‚úï Close</button>
            </div>
            <div class="form-group">
                <label class="form-label">Search Keywords</label>
                <input type="text" id="searchKeywords" class="form-control" placeholder="Search in title, content, or user...">
            </div>
            <div style="text-align: right;">
                <button onclick="performSearch()" class="btn btn-primary">üîç Search</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let statusChart = null;
        let categoryChart = null;
        let ratingChart = null;
        let metricsChart = null;
        let currentFeedbackId = null;
        let currentUsername = null;
        let allFeedbackData = [];
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        function createCharts(feedback) {
            // Status Chart
            const statusCounts = {
                pending: feedback.filter(f => f.status === 'pending').length,
                in_progress: feedback.filter(f => f.status === 'in_progress').length,
                resolved: feedback.filter(f => f.status === 'resolved').length
            };
            
            if (statusChart) statusChart.destroy();
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            statusChart = new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: ['‚è≥ Pending', 'üîÑ In Progress', '‚úÖ Resolved'],
                    datasets: [{
                        data: [statusCounts.pending, statusCounts.in_progress, statusCounts.resolved],
                        backgroundColor: ['#fbbf24', '#3b82f6', '#10b981'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 14 } } }
                    }
                }
            });
            
            // Category Chart
            const categoryCounts = {};
            feedback.forEach(f => {
                categoryCounts[f.category] = (categoryCounts[f.category] || 0) + 1;
            });
            
            if (categoryChart) categoryChart.destroy();
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 14 } } }
                    }
                }
            });
            
            // Rating Chart
            const ratingCounts = {};
            feedback.forEach(f => {
                const rating = `${f.rating} Star${f.rating !== 1 ? 's' : ''}`;
                ratingCounts[rating] = (ratingCounts[rating] || 0) + 1;
            });
            
            if (ratingChart) ratingChart.destroy();
            const ratingCtx = document.getElementById('ratingChart').getContext('2d');
            ratingChart = new Chart(ratingCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(ratingCounts),
                    datasets: [{
                        data: Object.values(ratingCounts),
                        backgroundColor: ['#dc2626', '#f59e0b', '#eab308', '#22c55e', '#16a34a'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 14 } } }
                    }
                }
            });
            
            // Key Metrics Chart
            const total = feedback.length;
            const responseRate = total > 0 ? ((feedback.filter(f => f.response && f.response !== 'No response').length / total) * 100).toFixed(1) : 0;
            const resolutionRate = total > 0 ? ((statusCounts.resolved / total) * 100).toFixed(1) : 0;
            
            if (metricsChart) metricsChart.destroy();
            const metricsCtx = document.getElementById('metricsChart').getContext('2d');
            metricsChart = new Chart(metricsCtx, {
                type: 'pie',
                data: {
                    labels: ['Response Rate', 'Resolution Rate', 'Pending Rate'],
                    datasets: [{
                        data: [responseRate, resolutionRate, (100 - resolutionRate).toFixed(1)],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 14 } } }
                    }
                }
            });
        }
        
        function loadAllFeedback() {
            const allFeedback = JSON.parse(localStorage.getItem('allFeedback') || '[]');
            allFeedbackData = allFeedback;
            const tableBody = document.getElementById('feedbackTableBody');
            
            if (allFeedback.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #6b7280;">üì≠ No feedback submitted yet</td></tr>';
                updateStatistics([]);
                return;
            }
            
            displayFeedback(allFeedback);
            updateStatistics(allFeedback);
        }
        
        function displayFeedback(feedback) {
            const tableBody = document.getElementById('feedbackTableBody');
            tableBody.innerHTML = '';
            
            feedback.forEach(item => {
                const row = document.createElement('tr');
                let statusClass = 'badge-pending';
                if (item.status === 'resolved') statusClass = 'badge-resolved';
                else if (item.status === 'in_progress') statusClass = 'badge-in-progress';
                
                const stars = '‚≠ê'.repeat(item.rating);
                const username = item.user || item.username || 'Unknown';
                
                row.innerHTML = `
                    <td><strong>${username}</strong></td>
                    <td>${item.title}</td>
                    <td><span style="background: #f1f5f9; padding: 4px 8px; border-radius: 6px; font-size: 0.875rem;">${item.category}</span></td>
                    <td>${stars} ${item.rating}/5</td>
                    <td><span class="badge ${statusClass}">${item.status.replace('_', ' ')}</span></td>
                    <td>${item.date}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="showResponse('${item.id}', '${username}')">üí¨</button>
                        <button class="btn btn-info btn-sm" onclick="viewDetails('${item.id}')">üëÅÔ∏è</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteFeedback('${item.id}', '${username}')">üóëÔ∏è</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateStatistics(feedback) {
            const total = feedback.length;
            const resolved = feedback.filter(f => f.status === 'resolved').length;
            const pending = feedback.filter(f => f.status === 'pending').length;
            const avgRating = total > 0 ? (feedback.reduce((sum, f) => sum + f.rating, 0) / total).toFixed(1) : 0;
            const responseRate = total > 0 ? ((feedback.filter(f => f.response && f.response !== 'No response').length / total) * 100).toFixed(1) : 0;
            
            document.getElementById('totalFeedback').textContent = total;
            document.getElementById('resolvedFeedback').textContent = resolved;
            document.getElementById('pendingFeedback').textContent = pending;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('responseRate').textContent = responseRate + '%';
        }
        
        function showResponse(feedbackId, username) {
            const feedback = allFeedbackData.find(f => f.id == feedbackId);
            if (!feedback) {
                showNotification('Feedback not found!', 'error');
                return;
            }
            
            currentFeedbackId = feedbackId;
            currentUsername = username;
            
            document.getElementById('feedbackInfo').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div><strong>Title:</strong> ${feedback.title}</div>
                    <div><strong>User:</strong> ${username}</div>
                    <div><strong>Category:</strong> ${feedback.category}</div>
                    <div><strong>Rating:</strong> ${'‚≠ê'.repeat(feedback.rating)} ${feedback.rating}/5</div>
                </div>
                <div style="margin-top: 15px;"><strong>Content:</strong><br>${feedback.content}</div>
            `;
            
            document.getElementById('statusSelect').value = feedback.status;
            document.getElementById('responseText').value = '';
            document.getElementById('responseModal').style.display = 'block';
        }
        
        function closeResponseModal() {
            document.getElementById('responseModal').style.display = 'none';
            currentFeedbackId = null;
            currentUsername = null;
        }
        
        function submitResponse() {
            const response = document.getElementById('responseText').value.trim();
            const status = document.getElementById('statusSelect').value;
            
            if (!response) {
                showNotification('Please enter a response.', 'error');
                return;
            }
            
            // Update admin feedback
            let allFeedback = JSON.parse(localStorage.getItem('allFeedback') || '[]');
            const adminFeedbackIndex = allFeedback.findIndex(f => f.id == currentFeedbackId);
            if (adminFeedbackIndex !== -1) {
                allFeedback[adminFeedbackIndex].response = response;
                allFeedback[adminFeedbackIndex].status = status;
                allFeedback[adminFeedbackIndex].responseDate = new Date().toLocaleDateString();
                localStorage.setItem('allFeedback', JSON.stringify(allFeedback));
            }
            
            // Update user's feedback
            const userKey = `feedback_${currentUsername}`;
            let userFeedback = JSON.parse(localStorage.getItem(userKey) || '[]');
            const feedbackIndex = userFeedback.findIndex(f => f.id == currentFeedbackId);
            if (feedbackIndex !== -1) {
                userFeedback[feedbackIndex].response = response;
                userFeedback[feedbackIndex].status = status;
                userFeedback[feedbackIndex].responseDate = new Date().toLocaleDateString();
                localStorage.setItem(userKey, JSON.stringify(userFeedback));
            }
            
            showNotification(`Response sent successfully! Status updated to: ${status.replace('_', ' ')}`);
            closeResponseModal();
            loadAllFeedback();
        }
        
        function viewDetails(feedbackId) {
            const feedback = allFeedbackData.find(f => f.id == feedbackId);
            if (feedback) {
                const username = feedback.user || feedback.username || 'Unknown';
                const responseText = feedback.response && feedback.response !== 'No response' ? feedback.response : 'No response yet';
                alert(`üìã Feedback Details\n\nüìù Title: ${feedback.title}\nüë§ User: ${username}\nüìÇ Category: ${feedback.category}\n‚≠ê Rating: ${feedback.rating}/5\nüìä Status: ${feedback.status}\nüìÖ Date: ${feedback.date}\n\nüí¨ Content:\n${feedback.content}\n\nüîÑ Admin Response:\n${responseText}`);
            }
        }
        
        function deleteFeedback(feedbackId, username) {
            if (!confirm('üóëÔ∏è Are you sure you want to delete this feedback?')) return;
            
            let allFeedback = JSON.parse(localStorage.getItem('allFeedback') || '[]');
            allFeedback = allFeedback.filter(f => f.id != feedbackId);
            localStorage.setItem('allFeedback', JSON.stringify(allFeedback));
            
            const userKey = `feedback_${username}`;
            let userFeedback = JSON.parse(localStorage.getItem(userKey) || '[]');
            userFeedback = userFeedback.filter(f => f.id != feedbackId);
            localStorage.setItem(userKey, JSON.stringify(userFeedback));
            
            showNotification('Feedback deleted successfully!');
            loadAllFeedback();
        }
        
        function filterFeedback() {
            const statusFilter = document.getElementById('statusFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const ratingFilter = document.getElementById('ratingFilter').value;
            
            let filtered = allFeedbackData;
            
            if (statusFilter !== 'all') {
                filtered = filtered.filter(f => f.status === statusFilter);
            }
            if (categoryFilter !== 'all') {
                filtered = filtered.filter(f => f.category === categoryFilter);
            }
            if (ratingFilter !== 'all') {
                filtered = filtered.filter(f => f.rating == ratingFilter);
            }
            
            displayFeedback(filtered);
            updateStatistics(filtered);
        }
        
        function showPendingOnly() {
            document.getElementById('statusFilter').value = 'pending';
            filterFeedback();
            showNotification('Showing pending feedback only');
        }
        
        function showStatisticalView() {
            createCharts(allFeedbackData);
            document.getElementById('statisticalModal').style.display = 'block';
        }
        
        function closeStatisticalModal() {
            document.getElementById('statisticalModal').style.display = 'none';
        }
        
        function showSearchModal() {
            document.getElementById('searchModal').style.display = 'block';
        }
        
        function closeSearchModal() {
            document.getElementById('searchModal').style.display = 'none';
        }
        
        function performSearch() {
            const keywords = document.getElementById('searchKeywords').value.toLowerCase().trim();
            if (!keywords) {
                showNotification('Please enter search keywords', 'error');
                return;
            }
            
            const filtered = allFeedbackData.filter(f => 
                f.title.toLowerCase().includes(keywords) ||
                f.content.toLowerCase().includes(keywords) ||
                (f.user && f.user.toLowerCase().includes(keywords)) ||
                (f.username && f.username.toLowerCase().includes(keywords))
            );
            
            displayFeedback(filtered);
            updateStatistics(filtered);
            closeSearchModal();
            showNotification(`Found ${filtered.length} matching results`);
        }
        
        function exportData() {
            if (allFeedbackData.length === 0) {
                showNotification('No data to export', 'error');
                return;
            }
            
            const csv = [
                ['User', 'Title', 'Category', 'Rating', 'Status', 'Date', 'Content', 'Response'],
                ...allFeedbackData.map(f => [
                    f.user || f.username || 'Unknown',
                    f.title,
                    f.category,
                    f.rating,
                    f.status,
                    f.date,
                    f.content,
                    f.response || 'No response'
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `feedback-data-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!');
        }
        
        function refreshData() {
            showNotification('Refreshing data...');
            setTimeout(() => {
                loadAllFeedback();
                showNotification('Data refreshed successfully!');
            }, 500);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            loadAllFeedback();
        });
    </script>
</body>
</html>
